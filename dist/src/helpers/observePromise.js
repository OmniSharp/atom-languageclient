"use strict";
/**
 *  @license   MIT
 *  @copyright OmniSharp Team
 *  @summary   Adds support for https://github.com/Microsoft/language-server-protocol (and more!) to https://atom.io
 */
var _ = require('lodash');
var vscode_jsonrpc_1 = require('vscode-jsonrpc');
var createObservable_1 = require('../helpers/createObservable');
function observePromise(method) {
    return createObservable_1.createObservable(function (observer) {
        var cts = new vscode_jsonrpc_1.CancellationTokenSource();
        method(cts.token).then(_.flow(_.bind(observer.next, observer), _.bind(observer.complete, observer)), _.bind(observer.error, observer));
        return function () { return cts.cancel(); };
    }).publishReplay(1).refCount();
}
exports.observePromise = observePromise;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoib2JzZXJ2ZVByb21pc2UuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi9zcmMvaGVscGVycy9vYnNlcnZlUHJvbWlzZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUE7Ozs7R0FJRztBQUNILElBQVksQ0FBQyxXQUFNLFFBQVEsQ0FBQyxDQUFBO0FBRTVCLCtCQUEyRCxnQkFBZ0IsQ0FBQyxDQUFBO0FBQzVFLGlDQUFpQyw2QkFBNkIsQ0FBQyxDQUFBO0FBRS9ELHdCQUFrQyxNQUFnRDtJQUM5RSxNQUFNLENBQUMsbUNBQWdCLENBQUksVUFBQSxRQUFRO1FBQy9CLElBQU0sR0FBRyxHQUFHLElBQUksd0NBQXVCLEVBQUUsQ0FBQztRQUMxQyxNQUFNLENBQUMsR0FBRyxDQUFDLEtBQUssQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLElBQUksRUFBRSxRQUFRLENBQUMsRUFBRSxDQUFDLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxRQUFRLEVBQUUsUUFBUSxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxLQUFLLEVBQUUsUUFBUSxDQUFDLENBQUMsQ0FBQztRQUN2SSxNQUFNLENBQUMsY0FBTSxPQUFBLEdBQUcsQ0FBQyxNQUFNLEVBQUUsRUFBWixDQUFZLENBQUM7SUFDOUIsQ0FBQyxDQUFDLENBQUMsYUFBYSxDQUFDLENBQUMsQ0FBQyxDQUFDLFFBQVEsRUFBRSxDQUFDO0FBQ25DLENBQUM7QUFOZSxzQkFBYyxpQkFNN0IsQ0FBQSIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxyXG4gKiAgQGxpY2Vuc2UgICBNSVRcclxuICogIEBjb3B5cmlnaHQgT21uaVNoYXJwIFRlYW1cclxuICogIEBzdW1tYXJ5ICAgQWRkcyBzdXBwb3J0IGZvciBodHRwczovL2dpdGh1Yi5jb20vTWljcm9zb2Z0L2xhbmd1YWdlLXNlcnZlci1wcm90b2NvbCAoYW5kIG1vcmUhKSB0byBodHRwczovL2F0b20uaW9cclxuICovXHJcbmltcG9ydCAqIGFzIF8gZnJvbSAnbG9kYXNoJztcclxuaW1wb3J0IHsgT2JzZXJ2YWJsZSB9IGZyb20gJ3J4anMnO1xyXG5pbXBvcnQgeyBDYW5jZWxsYXRpb25Ub2tlbiwgQ2FuY2VsbGF0aW9uVG9rZW5Tb3VyY2UgfSBmcm9tICd2c2NvZGUtanNvbnJwYyc7XHJcbmltcG9ydCB7IGNyZWF0ZU9ic2VydmFibGUgfSBmcm9tICcuLi9oZWxwZXJzL2NyZWF0ZU9ic2VydmFibGUnO1xyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIG9ic2VydmVQcm9taXNlPFQ+KG1ldGhvZDogKHRva2VuOiBDYW5jZWxsYXRpb25Ub2tlbikgPT4gUHJvbWlzZTxUPik6IE9ic2VydmFibGU8VD4ge1xyXG4gICAgcmV0dXJuIGNyZWF0ZU9ic2VydmFibGU8VD4ob2JzZXJ2ZXIgPT4ge1xyXG4gICAgICAgIGNvbnN0IGN0cyA9IG5ldyBDYW5jZWxsYXRpb25Ub2tlblNvdXJjZSgpO1xyXG4gICAgICAgIG1ldGhvZChjdHMudG9rZW4pLnRoZW4oXy5mbG93KF8uYmluZChvYnNlcnZlci5uZXh0LCBvYnNlcnZlciksIF8uYmluZChvYnNlcnZlci5jb21wbGV0ZSwgb2JzZXJ2ZXIpKSwgXy5iaW5kKG9ic2VydmVyLmVycm9yLCBvYnNlcnZlcikpO1xyXG4gICAgICAgIHJldHVybiAoKSA9PiBjdHMuY2FuY2VsKCk7XHJcbiAgICB9KS5wdWJsaXNoUmVwbGF5KDEpLnJlZkNvdW50KCk7XHJcbn1cclxuIl19