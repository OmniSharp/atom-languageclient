"use strict";
/**
 *  @license   MIT
 *  @copyright OmniSharp Team
 *  @summary   Adds support for https://github.com/Microsoft/language-server-protocol (and more!) to https://atom.io
 */
/* tslint:disable */
var cp = require('child_process');
var net = require('net');
var os = require('os');
var path = require('path');
function makeRandomHexString(length) {
    var chars = ['0', '1', '2', '3', '4', '5', '6', '6', '7', '8', '9', 'a', 'b', 'c', 'd', 'e', 'f'];
    var result = '';
    for (var i = 0; i < length; i++) {
        var idx = Math.floor(chars.length * Math.random());
        result += chars[idx];
    }
    return result;
}
function generatePipeName() {
    var randomName = 'atom-' + makeRandomHexString(40);
    if (process.platform === 'win32') {
        return '\\\\.\\pipe\\' + randomName + '-sock';
    }
    // Mac/Unix: use socket file
    return path.join(os.tmpdir(), randomName + '.sock');
}
function generatePatchedEnv(env, stdInPipeName, stdOutPipeName) {
    // Set the two unique pipe names and the electron flag as process env
    var newEnv = {};
    for (var key in env) {
        newEnv[key] = env[key];
    }
    newEnv['STDIN_PIPE_NAME'] = stdInPipeName;
    newEnv['STDOUT_PIPE_NAME'] = stdOutPipeName;
    newEnv['ATOM_SHELL_INTERNAL_RUN_AS_NODE'] = '1';
    return newEnv;
}
function fork(modulePath, args, options, callback) {
    var callbackCalled = false;
    var resolve = function (result) {
        if (callbackCalled) {
            return;
        }
        callbackCalled = true;
        callback(null, result);
    };
    var reject = function (err) {
        if (callbackCalled) {
            return;
        }
        callbackCalled = true;
        callback(err, null);
    };
    // Generate two unique pipe names
    var stdInPipeName = generatePipeName();
    var stdOutPipeName = generatePipeName();
    var newEnv = generatePatchedEnv(options.env || process.env, stdInPipeName, stdOutPipeName);
    var childProcess;
    // Begin listening to stdout pipe
    var server = net.createServer(function (stream) {
        // The child process will write exactly one chunk with content `ready` when it has installed a listener to the stdin pipe
        stream.once('data', function (chunk) {
            // The child process is sending me the `ready` chunk, time to connect to the stdin pipe
            childProcess.stdin = net.connect(stdInPipeName);
            // From now on the childProcess.stdout is available for reading
            childProcess.stdout = stream;
            resolve(childProcess);
        });
    });
    server.listen(stdOutPipeName);
    var serverClosed = false;
    var closeServer = function () {
        if (serverClosed) {
            return;
        }
        serverClosed = true;
        server.close();
    };
    // Create the process
    var bootstrapperPath = path.join(__dirname, 'electronForkStart');
    childProcess = cp.fork(bootstrapperPath, [modulePath].concat(args), {
        silent: true,
        cwd: options.cwd,
        env: newEnv,
        execArgv: options.execArgv
    });
    childProcess.once('error', function (err) {
        closeServer();
        reject(err);
    });
    childProcess.once('exit', function (err) {
        closeServer();
        reject(err);
    });
}
exports.fork = fork;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZWxlY3Ryb24uanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi9zcmMvcHJvdG9jb2wvdXRpbHMvZWxlY3Ryb24udHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBOzs7O0dBSUc7QUFDSCxvQkFBb0I7QUFDcEIsSUFBWSxFQUFFLFdBQU0sZUFBZSxDQUFDLENBQUE7QUFDcEMsSUFBWSxHQUFHLFdBQU0sS0FBSyxDQUFDLENBQUE7QUFDM0IsSUFBWSxFQUFFLFdBQU0sSUFBSSxDQUFDLENBQUE7QUFDekIsSUFBWSxJQUFJLFdBQU0sTUFBTSxDQUFDLENBQUE7QUFTN0IsNkJBQTZCLE1BQWM7SUFDdkMsSUFBTSxLQUFLLEdBQUcsQ0FBQyxHQUFHLEVBQUUsR0FBRyxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxDQUFDLENBQUM7SUFDcEcsSUFBSSxNQUFNLEdBQUcsRUFBRSxDQUFDO0lBQ2hCLEdBQUcsQ0FBQyxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLEdBQUcsTUFBTSxFQUFFLENBQUMsRUFBRSxFQUFFLENBQUM7UUFDOUIsSUFBTSxHQUFHLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxLQUFLLENBQUMsTUFBTSxHQUFHLElBQUksQ0FBQyxNQUFNLEVBQUUsQ0FBQyxDQUFDO1FBQ3JELE1BQU0sSUFBSSxLQUFLLENBQUMsR0FBRyxDQUFDLENBQUM7SUFDekIsQ0FBQztJQUNELE1BQU0sQ0FBQyxNQUFNLENBQUM7QUFDbEIsQ0FBQztBQUVEO0lBQ0ksSUFBTSxVQUFVLEdBQUcsT0FBTyxHQUFHLG1CQUFtQixDQUFDLEVBQUUsQ0FBQyxDQUFDO0lBQ3JELEVBQUUsQ0FBQyxDQUFDLE9B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LEdBQUcsSUFBSSxDQUFDLElBQUksQ0FBQyxTQUFTLEVBQUUsbUJBQW1CLENBQUMsQ0FBQztJQUNuRSxZQUFZLEdBQUcsRUFBRSxDQUFDLElBQUksQ0FBQyxnQkFBZ0IsRUFBRSxDQUFDLFVBQVUsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsRUFBTztRQUNyRSxNQUFNLEVBQUUsSUFBSTtRQUNaLEdBQUcsRUFBRSxPQUFPLENBQUMsR0FBRztRQUNoQixHQUFHLEVBQUUsTUFBTTtRQUNYLFFBQVEsRUFBRSxPQUFPLENBQUMsUUFBUTtLQUM3QixDQUFDLENBQUM7SUFFSCxZQUFZLENBQUMsSUFBSSxDQUFDLE9BQU8sRUFBRSxVQUFDLEdBQVU7UUFDbEMsV0FBVyxFQUFFLENBQUM7UUFDZCxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUM7SUFDaEIsQ0FBQyxDQUFDLENBQUM7SUFFSCxZQUFZLENBQUMsSUFBSSxDQUFDLE1BQU0sRUFBRSxVQUFDLEdBQVU7UUFDakMsV0FBVyxFQUFFLENBQUM7UUFDZCxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUM7SUFDaEIsQ0FBQyxDQUFDLENBQUM7QUFDUCxDQUFDO0FBckVlLFlBQUksT0FxRW5CLENBQUEiLCJzb3VyY2VzQ29udGVudCI6WyIvKipcclxuICogIEBsaWNlbnNlICAgTUlUXHJcbiAqICBAY29weXJpZ2h0IE9tbmlTaGFycCBUZWFtXHJcbiAqICBAc3VtbWFyeSAgIEFkZHMgc3VwcG9ydCBmb3IgaHR0cHM6Ly9naXRodWIuY29tL01pY3Jvc29mdC9sYW5ndWFnZS1zZXJ2ZXItcHJvdG9jb2wgKGFuZCBtb3JlISkgdG8gaHR0cHM6Ly9hdG9tLmlvXHJcbiAqL1xyXG4vKiB0c2xpbnQ6ZGlzYWJsZSAqL1xyXG5pbXBvcnQgKiBhcyBjcCBmcm9tICdjaGlsZF9wcm9jZXNzJztcclxuaW1wb3J0ICogYXMgbmV0IGZyb20gJ25ldCc7XHJcbmltcG9ydCAqIGFzIG9zIGZyb20gJ29zJztcclxuaW1wb3J0ICogYXMgcGF0aCBmcm9tICdwYXRoJztcclxuXHJcbmV4cG9ydCBpbnRlcmZhY2UgSUZvcmtPcHRpb25zIHtcclxuICAgIGN3ZD86IHN0cmluZztcclxuICAgIGVudj86IGFueTtcclxuICAgIGVuY29kaW5nPzogc3RyaW5nO1xyXG4gICAgZXhlY0FyZ3Y/OiBzdHJpbmdbXTtcclxufVxyXG5cclxuZnVuY3Rpb24gbWFrZVJhbmRvbUhleFN0cmluZyhsZW5ndGg6IG51bWJlcik6IHN0cmluZyB7XHJcbiAgICBjb25zdCBjaGFycyA9IFsnMCcsICcxJywgJzInLCAnMycsICc0JywgJzUnLCAnNicsICc2JywgJzcnLCAnOCcsICc5JywgJ2EnLCAnYicsICdjJywgJ2QnLCAnZScsICdmJ107XHJcbiAgICBsZXQgcmVzdWx0ID0gJyc7XHJcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IGxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgY29uc3QgaWR4ID0gTWF0aC5mbG9vcihjaGFycy5sZW5ndGggKiBNYXRoLnJhbmRvbSgpKTtcclxuICAgICAgICByZXN1bHQgKz0gY2hhcnNbaWR4XTtcclxuICAgIH1cclxuICAgIHJldHVybiByZXN1bHQ7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGdlbmVyYXRlUGlwZU5hbWUoKTogc3RyaW5nIHtcclxuICAgIGNvbnN0IHJhbmRvbU5hbWUgPSAnYXRvbS0nICsgbWFrZVJhbmRvbUhleFN0cmluZyg0MCk7XHJcbiAgICBpZiAocHJvY2Vzcy5wbGF0Zm9ybSA9PT0gJ3dpbjMyJykge1xyXG4gICAgICAgIHJldHVybiAnXFxcXFxcXFwuXFxcXHBpcGVcXFxcJyArIHJhbmRvbU5hbWUgKyAnLXNvY2snO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIE1hYy9Vbml4OiB1c2Ugc29ja2V0IGZpbGVcclxuICAgIHJldHVybiBwYXRoLmpvaW4ob3MudG1wZGlyKCksIHJhbmRvbU5hbWUgKyAnLnNvY2snKTtcclxufVxyXG5cclxuZnVuY3Rpb24gZ2VuZXJhdGVQYXRjaGVkRW52KGVudjogYW55LCBzdGRJblBpcGVOYW1lOiBzdHJpbmcsIHN0ZE91dFBpcGVOYW1lOiBzdHJpbmcpOiBhbnkge1xyXG4gICAgLy8gU2V0IHRoZSB0d28gdW5pcXVlIHBpcGUgbmFtZXMgYW5kIHRoZSBlbGVjdHJvbiBmbGFnIGFzIHByb2Nlc3MgZW52XHJcblxyXG4gICAgY29uc3QgbmV3RW52OiBhbnkgPSB7fTtcclxuICAgIGZvciAoY29uc3Qga2V5IGluIGVudikge1xyXG4gICAgICAgIG5ld0VudltrZXldID0gZW52W2tleV07XHJcbiAgICB9XHJcblxyXG4gICAgbmV3RW52WydTVERJTl9QSVBFX05BTUUnXSA9IHN0ZEluUGlwZU5hbWU7XHJcbiAgICBuZXdFbnZbJ1NURE9VVF9QSVBFX05BTUUnXSA9IHN0ZE91dFBpcGVOYW1lO1xyXG4gICAgbmV3RW52WydBVE9NX1NIRUxMX0lOVEVSTkFMX1JVTl9BU19OT0RFJ10gPSAnMSc7XHJcblxyXG4gICAgcmV0dXJuIG5ld0VudjtcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIGZvcmsobW9kdWxlUGF0aDogc3RyaW5nLCBhcmdzOiBzdHJpbmdbXSwgb3B0aW9uczogSUZvcmtPcHRpb25zLCBjYWxsYmFjazogKGVycm9yOiBhbnksIGNwOiBjcC5DaGlsZFByb2Nlc3MpID0+IHZvaWQpOiB2b2lkIHtcclxuXHJcbiAgICBsZXQgY2FsbGJhY2tDYWxsZWQgPSBmYWxzZTtcclxuICAgIGNvbnN0IHJlc29sdmUgPSAocmVzdWx0OiBjcC5DaGlsZFByb2Nlc3MpID0+IHtcclxuICAgICAgICBpZiAoY2FsbGJhY2tDYWxsZWQpIHtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuICAgICAgICBjYWxsYmFja0NhbGxlZCA9IHRydWU7XHJcbiAgICAgICAgY2FsbGJhY2sobnVsbCwgcmVzdWx0KTtcclxuICAgIH07XHJcbiAgICBjb25zdCByZWplY3QgPSAoZXJyOiBhbnkpID0+IHtcclxuICAgICAgICBpZiAoY2FsbGJhY2tDYWxsZWQpIHtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuICAgICAgICBjYWxsYmFja0NhbGxlZCA9IHRydWU7XHJcbiAgICAgICAgY2FsbGJhY2soZXJyLCA8YW55Pm51bGwpO1xyXG4gICAgfTtcclxuXHJcbiAgICAvLyBHZW5lcmF0ZSB0d28gdW5pcXVlIHBpcGUgbmFtZXNcclxuICAgIGNvbnN0IHN0ZEluUGlwZU5hbWUgPSBnZW5lcmF0ZVBpcGVOYW1lKCk7XHJcbiAgICBjb25zdCBzdGRPdXRQaXBlTmFtZSA9IGdlbmVyYXRlUGlwZU5hbWUoKTtcclxuXHJcbiAgICBjb25zdCBuZXdFbnYgPSBnZW5lcmF0ZVBhdGNoZWRFbnYob3B0aW9ucy5lbnYgfHwgcHJvY2Vzcy5lbnYsIHN0ZEluUGlwZU5hbWUsIHN0ZE91dFBpcGVOYW1lKTtcclxuXHJcbiAgICBsZXQgY2hpbGRQcm9jZXNzOiBjcC5DaGlsZFByb2Nlc3M7XHJcblxyXG4gICAgLy8gQmVnaW4gbGlzdGVuaW5nIHRvIHN0ZG91dCBwaXBlXHJcbiAgICBjb25zdCBzZXJ2ZXIgPSBuZXQuY3JlYXRlU2VydmVyKChzdHJlYW0pID0+IHtcclxuICAgICAgICAvLyBUaGUgY2hpbGQgcHJvY2VzcyB3aWxsIHdyaXRlIGV4YWN0bHkgb25lIGNodW5rIHdpdGggY29udGVudCBgcmVhZHlgIHdoZW4gaXQgaGFzIGluc3RhbGxlZCBhIGxpc3RlbmVyIHRvIHRoZSBzdGRpbiBwaXBlXHJcblxyXG4gICAgICAgIHN0cmVhbS5vbmNlKCdkYXRhJywgKGNodW5rOiBCdWZmZXIpID0+IHtcclxuICAgICAgICAgICAgLy8gVGhlIGNoaWxkIHByb2Nlc3MgaXMgc2VuZGluZyBtZSB0aGUgYHJlYWR5YCBjaHVuaywgdGltZSB0byBjb25uZWN0IHRvIHRoZSBzdGRpbiBwaXBlXHJcbiAgICAgICAgICAgIGNoaWxkUHJvY2Vzcy5zdGRpbiA9IDxhbnk+bmV0LmNvbm5lY3Qoc3RkSW5QaXBlTmFtZSk7XHJcblxyXG4gICAgICAgICAgICAvLyBGcm9tIG5vdyBvbiB0aGUgY2hpbGRQcm9jZXNzLnN0ZG91dCBpcyBhdmFpbGFibGUgZm9yIHJlYWRpbmdcclxuICAgICAgICAgICAgY2hpbGRQcm9jZXNzLnN0ZG91dCA9IHN0cmVhbTtcclxuXHJcbiAgICAgICAgICAgIHJlc29sdmUoY2hpbGRQcm9jZXNzKTtcclxuICAgICAgICB9KTtcclxuICAgIH0pO1xyXG4gICAgc2VydmVyLmxpc3RlbihzdGRPdXRQaXBlTmFtZSk7XHJcblxyXG4gICAgbGV0IHNlcnZlckNsb3NlZCA9IGZhbHNlO1xyXG4gICAgY29uc3QgY2xvc2VTZXJ2ZXIgPSAoKSA9PiB7XHJcbiAgICAgICAgaWYgKHNlcnZlckNsb3NlZCkge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHNlcnZlckNsb3NlZCA9IHRydWU7XHJcbiAgICAgICAgc2VydmVyLmNsb3NlKCk7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gQ3JlYXRlIHRoZSBwcm9jZXNzXHJcbiAgICBjb25zdCBib290c3RyYXBwZXJQYXRoID0gcGF0aC5qb2luKF9fZGlybmFtZSwgJ2VsZWN0cm9uRm9ya1N0YXJ0Jyk7XHJcbiAgICBjaGlsZFByb2Nlc3MgPSBjcC5mb3JrKGJvb3RzdHJhcHBlclBhdGgsIFttb2R1bGVQYXRoXS5jb25jYXQoYXJncyksIDxhbnk+e1xyXG4gICAgICAgIHNpbGVudDogdHJ1ZSxcclxuICAgICAgICBjd2Q6IG9wdGlvbnMuY3dkLFxyXG4gICAgICAgIGVudjogbmV3RW52LFxyXG4gICAgICAgIGV4ZWNBcmd2OiBvcHRpb25zLmV4ZWNBcmd2XHJcbiAgICB9KTtcclxuXHJcbiAgICBjaGlsZFByb2Nlc3Mub25jZSgnZXJyb3InLCAoZXJyOiBFcnJvcikgPT4ge1xyXG4gICAgICAgIGNsb3NlU2VydmVyKCk7XHJcbiAgICAgICAgcmVqZWN0KGVycik7XHJcbiAgICB9KTtcclxuXHJcbiAgICBjaGlsZFByb2Nlc3Mub25jZSgnZXhpdCcsIChlcnI6IEVycm9yKSA9PiB7XHJcbiAgICAgICAgY2xvc2VTZXJ2ZXIoKTtcclxuICAgICAgICByZWplY3QoZXJyKTtcclxuICAgIH0pO1xyXG59XHJcbiJdfQ==